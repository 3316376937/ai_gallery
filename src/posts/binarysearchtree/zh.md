---
title: Claude3.5 实现二叉搜索树的可视化
date: '2024-08-23 12:00:00'
tags: ['claude']
keywords: ['Claude3.5 辅助前端', '二叉搜索树', '算法可视化']
description: 
---

在看 [LevelDB 源码](https://selfboot.cn/tags/leveldb/) 的时候，里面有跳表实现，然后跳表的论文中有提到二叉搜索树，于是想着来实现一个二叉搜索树的可视化。于是开始压榨 Claude3.5，让它和我一起实现。

这里是最终效果，大家可以来体验：

![二叉搜索树可视化]()

## 简单版本

Claude3.5 整体理解能力不错，按照之前的经验，开始的时候提示词可以很简单就行，Claude3.5 有不少先验的知识。我的提示词如下：

> 我想用 react 和 tailwind 实现一个搜索二叉树的可视化。给定 key，生成二叉树，支持插入，删除和查找操作。

另外，项目其他部分用了 headlessui，为了保持风格统一，同时不引入过多 UI 组件，所以这里告诉 Claude 继续用 headlessui。第一个版本很快就好了，但是页面什么都没有，只有一个空白的区域。于是继续提问：

> 我想要看到可视化的一个二叉树的，目前什么都没。

Claude 修复了一些问题，接着我再次刷新页面，就看到了一个二叉树的结构。不过这时候输入数字，然后点插入节点后，整个页面又没有内容了。继续提问：

> 现在输入数字点插入后，整个树不见了

Claude3.5 承认这个是一个严重的 bug，还真是敢于认错呢，哈哈。接着给出了修复方案，主要是确保在插入新节点后能更新树的可视化展示。

经过前面的几轮对话，已经有一个初步的版本了。目前在二叉搜索树中支持插入，删除和查找操作，并且能给出树节点的可视化展示。下面是这个版本的效果图：

![二叉搜索树可视化初始版本](https://slefboot-1251736664.file.myqcloud.com/20240826_ai_gallery_bst_first.png)

## 树布局优化

不过这个版本的树布局还是有点问题，插入多几个节点，**树的高度稍微深一些，就会变得特别宽，导致在屏幕上需要滚动才能看到整个树**。我想要的树布局，能够紧凑一些，在屏幕中显示更多的节点，这样体验会更好些。这里经过了好多轮的对话，不断调整一些细节，整体比较曲折。

其实开始的时候自己的思路也不太对，想着用之前[堆的可视化中](https://gallery.selfboot.cn/zh/algorithms/heap)节点的布局算法。提示词如下：

> 插入后树的宽度很宽，不适合阅读了。
> 这里提供你一个思路，来合适画树的结构。
> 
> 每次增加新的层之后，你要保证最底层节点很紧密，可以间隔一个节点的宽度。然后逐层往上面计算每层节点之间的间隔。之后根据这些间隔来绘制整个树。

Claude 照常拍马屁，然后就按照这个思路来实现，效果并不好，因为这里二叉搜索树每层可能比较稀疏，导致中间层节点之间的间隔太大。和最开始的版本有同样的问题，甚至更严重些，如下图：

![二叉搜索树可视化布局间距过大](https://slefboot-1251736664.file.myqcloud.com/20240826_ai_gallery_bst_heap.png)

那么直接提示它，让它每层间距不要太大，布局紧凑些，然后同一层的节点不要有重叠就好。得到了下面的结果：

![二叉搜索树可视化-错误的版本](https://slefboot-1251736664.file.myqcloud.com/20240827_ai_gallery_bst_error.png)

这里是紧凑了，不过节点分布都有问题，左右子树节点位置都不对。中间经过几轮尝试，自己的思路也慢慢清晰，我们想要树布局尽量紧凑，同时不能有节点的交叉和重叠，那么只需要满足：

1. 每个节点的所有子节点都必须在所有**左兄弟节点**的右侧。
2. 每个节点的所有子节点都必须在所有**右兄弟节点**的左侧。

也就是说在同一层中，所有小的节点肯定要在大的节点左边，不能有重叠交叉。**想好算法之后**，把上面算法简单描述了下，Claude3.5 很快就给出了实现思路，整体改动如下：

1. 新的布局算法：_updateLayout 方法现在使用一种新的算法来分配节点坐标。
2. 节点计数：引入了 getNodeCount 函数来计算每个子树的节点数量，这有助于更准确地分配空间。
3. 递归坐标分配：assignCoordinates 函数递归地为每个节点分配坐标，确保左子树总是在右子树的左边。
4. 动态空间分配：每个节点的位置是基于其左右子树的节点数量动态计算的，这确保了更均匀的分布。
5. 层次对齐：同一层的节点会有相同的y坐标，确保水平对齐。
6. 避免交叉：通过计算每个节点的相对位置，确保同一层的节点从左到右按大小排序，避免了交叉问题。

下面是布局的效果图，可以看到在有很多节点的情况下，整体布局比较紧凑，并且符合前面的要求。

![二叉搜索树可视化布局优化](https://slefboot-1251736664.file.myqcloud.com/20240826_ai_gallery_bst_layout.png)

## 优化界面

二叉搜索树的布局问题解决了，接着优化下界面部分。目前比较简单，只能输入数字，然后插入，删除和查找节点。但是一个个节点插入的话也比较麻烦，可以支持一种更方便的初始化节点方法。考虑到二叉搜索树在顺序插入和随机插入下的性能差异，这里可以支持两种初始化方式。同时为了让整个页面布局和其他可视化工具保持基本一致，这里也调整了下设置部分的布局。

由于之前的聊天上下文已经够长了，为了**避免更快消耗 Claude3.5 的额度**：

> Your limit gets used up faster with longer conversations, notably with large attachments. For example, if you upload a copy of The Great Gatsby, you may only be able to send 15 messages in that conversation within 5 hours, as each time you send a message, Claude “re-reads” the entire conversation, including any large attachments.
> Ref: https://support.anthropic.com/en/articles/8324991-about-claude-pro-usage

接着在 Claude 新开了一个对话，直接把之前的完整代码复制过去，然后提示如下：

> 这里是二叉搜索树的可视化实现。帮我优化下：
> 1. 分两个区域。大屏幕下分左右，左边是展示区域，占3/4，右边是设置区域，占1/4，每个按钮一行。小屏幕下分上下，上面是设置，下面是展示；
> 2. 支持设置初始的节点数量，最大可以50个。然后支持选择初始化方法，有随机初始化和顺序初始化。

于是 Claude 重构了界面部分，增加了初始化按钮。不过开始的版本 SVG 树部分不支持滚动，节点可能会超出屏幕，又重新提示一遍，加上了滚动条。最后效果如下，这里是按照顺序初始化 15 个节点：

![二叉搜索树可视化界面效果](https://slefboot-1251736664.file.myqcloud.com/20240827_ai_gallery_bst_improve.png)

## 添加动画



## 收尾工作

### 国际化支持

### 尝试优化

### 测试

