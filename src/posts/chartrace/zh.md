---
title: Claude3.5 打造漂亮的动态竞速图工具
date: '2024-09-08 14:00:00'
tags: ['claude']
keywords: ['Claude3.5 辅助前端', '竞速图工具', '动态图表生成工具']
description: 本文用 Claude3.5 实现一个竞速图工具，支持上传数据生成动态竞速图，支持自定义列名，支持预览数据。
---

时不时在网上看到一些漂亮的竞速图页面，展示数据随时间的变化情况，看着很酷。然后查了下有现成的 js 库可以生成这种图表，不过没找到一个合适的工具，可以将数据上传后，自动生成竞速图。

于是想着用 Claude3.5 实现一个，不过这个过程并不顺利，中间踩了不少坑。从 7 月份都开始着手，中间断断续续尝试了多次，直到最近才算实现了一个简单的版本。本文记录下用 Calude3.5 实现这个工具的过程，记录其中踩过的坑。最终的效果可以在[这里](https://gallery.selfboot.cn/zh/tools/bar_chart_race)体验，欢迎大家留言讨论。

## 失败尝试

最开始的时候，想着比较简单，就先去找了下目前哪些库支持动态竞速图。


决定用 于是就直接提示：

> 帮我用 react 实现一个网页工具，可以根据用户传的 json 数据，生成动态竞速表。
    

生成了一个粗糙的代码，需要特定的数据才能跑起来。并且效果也很差，就暂时搁置了。

![粗糙的竞速图](https://slefboot-1251736664.file.myqcloud.com/20240926_ai_gallery_chartrace_ugly_version.png)

## 继续尝试

最近用 cursor 比较舒服，就想着再来试试。原来的代码能解析 json，然后也能跑起来，这次想着一次性支持多点，能够支持传入 excel 或者 csv 文件，然后数据格式也可以自定义这样子。

打开原来的代码，选定代码后，直接提示：

> 我想支持传入 excel 或者 csv 文件，然后生成竞速直方图。
> 用 ReactECharts 实现，完善下面的代码。

然后 claude3.5 让我导入 excel 库，这里踩了坑，先让我从 xlsx 导入，结果安装的是 xlsx-js-style，货不对版。重新提示修好这些小问题后，让它生成了一份示例数据，然后想着来拿示例数据测试下。示例数据虽然短，不过内容倒是不错：

| 年份 | 类别 | 数值 |
|------|------|------|
| 2015 | 苹果 | 100 |
| 2015 | 香蕉 | 80 |
| 2015 | 橙子 | 60 |
| 2015 | 葡萄 | 40 |
| 2015 | 芒果 | 20 |
| 2016 | 苹果 | 120 |
| 2016 | 香蕉 | 90 |
| 2016 | 橙子 | 70 |
| 2016 | 葡萄 | 50 |
| 2016 | 芒果 | 30 |
| 2017 | 苹果 | 130 |
| 2017 | 香蕉 | 110 |
| 2017 | 橙子 | 90 |
| 2017 | 葡萄 | 70 |
| 2017 | 芒果 | 50 |

这里第一列是时间，第二列是类别，第三列是值，每列名字可以自定义，传入文件后希望能根据时间，生成不同类别的数值动态竞速图。搞好一个版本后，发现传入csv 和 excel 还是不行，必须先传入 excel，再传一个 json 才能生成一个简单竞速图。先不说这个过程有多奇怪，这里竞速图的纵坐标也没有类别的名字。

为了让它能在纵坐标支持名字，花了好长时间，提示了几次也不太行。中间改动还导致连动态图也出不来了，然后加了日志，发现导入的数据解析有问题。让 Claude3.5 反复分析了好几轮，始终没有找到解决方法，看来 Claude3.5 还是**不太适合做这种复杂的分析**。

## 动态竞速图样例

算了，不再继续尝试，不如看看[官方示例](https://echarts.apache.org/examples/en/editor.html?c=bar-race-country)是怎么做的。**毕竟只有自己懂怎么写，才能指导 AI 写出来**。官方示例代码足够简单，样式也很好看，如下：

![官方的竞速直方图示例](https://slefboot-1251736664.file.myqcloud.com/20240926_ai_gallery_chartrace_demo.png)

代码看起来也不是很复杂，导入数据后，指定下动态竞速图的配置，然后很简单就可以生成一个动态竞速图。把这部分提供给 Claude3.5 解读，让它作为参考代码，它肯定能理解。

既然生成动态竞速图的逻辑已经知道，那么剩下的就是处理前端页面，让用户可以上传文件，然后解析文件，生成动态竞速图。这里**让 AI 直接生成这么多，还是有复杂度，人工拆分任务，让 Claude3.5 一点点完成呢**？

## 拆分问题！

### 处理上传逻辑

### 预览逻辑

### 竞速图生成部分

### 继续完善细节

![竞速图生成完成](https://slefboot-1251736664.file.myqcloud.com/20240926_ai_gallery_chartrace_claude_log.png)






## Cursor Claude3.5 缺陷

用的过程中，点击 Apply 之后，发现变更的 diff 中，把已经写好的代码删掉，用注释来替换了。所以对于变更，还是不能无脑 Apply，还要人工检查下才行。

此外写的过程中，比如你随手改了一个地方。后续 AI 生成的时候，可能又给你改回去。比如下图：

![AI 错误修改改动的代码](https://slefboot-1251736664.file.myqcloud.com/20240926_ai_gallery_chartrace_Claude_error.png)

猜测这里可能是 cursor 选择代码版本的时候，并没有用当前编辑器中的版本。而是自己在上下文维护了一个版本，然后基于维护的版本给 AI 生成，之后在 diff 的时候，用了老的版本来覆盖编辑器改动过的版本。

还有一个很不爽的地方就是，Claude3.5 在功能改动的时候，经常忘记删掉多余的代码。比如一个功能已经改变了实现，经常只是增加代码，没有删除掉不用的代码。比如下图，这里渲染的时候没有用到一些状态，但是还在。只能提示它去删掉，好在稍微提示下，它就立马知道怎么删除了。

![AI 生成代码的时候没有删除不用的](https://slefboot-1251736664.file.myqcloud.com/20240926_ai_gallery_chartrace_claude_delete.png)

## 后续优化

找到和 Claude3.5 沟通的方法后，从零写一个工具还是挺快的。当然使用 AI 的过程还是离不开人工哈，中间需要去检查 AI 的输出，并且加日志调试，才能解决一些奇怪的问题。

你想要什么的工具？动手开始写吧～欢迎评论区留言一起交流！